rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Regras para utilizadores
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow create: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regras para treinos personalizados
    match /workouts/{workoutId} {
      allow read: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.userId;
    }
    
    // Regras para workouts pré-feitos (públicos para leitura)
    // IMPORTANTE: Estas regras permitem leitura pública (mesmo sem autenticação)
    match /prebuilt_workouts/{workoutId} {
      allow read: if true; // Qualquer pessoa pode ler (autenticado ou não)
      allow write: if false; // Apenas admins podem escrever (via scripts Node.js)
    }
    
    // Regras para PRs
    match /personal_records/{prId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Regras para rotinas
    match /routines/{routineId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
    }
    
    // Regras para biblioteca de exercícios (pública para leitura)
    match /exercise_library/{exerciseId} {
      allow read: if true; // Qualquer pessoa pode ler (autenticado ou não)
      allow write: if false; // Apenas admins podem escrever (via scripts Node.js)
    }
    
    // Regras para profissionais (pública)
    match /professionals/{professionalId} {
      allow read: if true; // Qualquer pessoa pode ler (autenticado ou não)
      allow write: if false; // Apenas admins podem escrever (via scripts Node.js)
    }
    
    // Regras para configuração da app (pública para leitura)
    match /app_config/{configId} {
      allow read: if true; // Qualquer pessoa pode ler (autenticado ou não)
      allow write: if false; // Apenas admins podem escrever (via scripts Node.js)
    }
  }
}

